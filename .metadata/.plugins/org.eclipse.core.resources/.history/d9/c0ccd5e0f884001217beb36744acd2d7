package ru.spbstu.telematics.ivanov722.lab3m;

import java.util.Random;

public class CarBlueSN implements Runnable {

	@Override
	public void run() {
		while (true) {
			try {
				//ждем до 2 секунд прежде чем респаунитьс€
				long sleepTime = new Random().nextInt(2000);
				Thread.sleep(sleepTime);
				
				
				
				
				
				
				CrossRoad.getLockCardirS().lock();
				System.out.println("—ин€€ машина (S) подъезжает к перекрестку");
				CrossRoad.getLockCardirW().lock();
				System.out.println("—ин€€ машина (S) выезжает на перекресток");
				CrossRoad.getLockSectionSE().lock();
				System.out.println("—ин€€ машина (S) занимает секцию SE");
				CrossRoad.getLockSectionNE().lock();
				System.out.println("—ин€€ машина (S) занимает секцию NE");
				try {
					//захватываем участки
					CrossRoad.setBusyCardirS(true);	
					CrossRoad.setBusyCardirW(true);	
					CrossRoad.setBusySectionSE(true);		
					CrossRoad.setBusySectionNE(true);
					
					//захватили, ждем какое-то врем€
					Thread.sleep(500);
					
					//отпускаем всех, кого захватили
					CrossRoad.setBusyCardirS(false);	
					CrossRoad.setBusyCardirW(false);	
					CrossRoad.setBusySectionSE(false);		
					CrossRoad.setBusySectionNE(false);
					
				} finally {
					CrossRoad.getLockCardirS().unlock();
					CrossRoad.getLockCardirW().unlock();
					CrossRoad.getLockSectionSE().unlock();
					CrossRoad.getLockSectionNE().unlock();
				}
				
				System.out.println("—ин€€ машина (S) покинула перекресток");
				
			} catch (InterruptedException e) {
				e.printStackTrace();
			}
			
		}
	}

}
