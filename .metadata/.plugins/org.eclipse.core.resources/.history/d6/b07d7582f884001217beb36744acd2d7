package ru.spbstu.telematics.ivanov722.lab3m;

import java.util.Random;

public class CarGreenNS implements Runnable {

	@Override
	public void run() {
		while (true) {
			try {
				//ждем до 2 секунд прежде чем респауниться
				long sleepTime = new Random().nextInt(2000);
				Thread.sleep(sleepTime);
				
				
				
				
				
				
				CrossRoad.getLockCardirN().lock();
				System.out.println("Зеленая машина (n) подъезжает к перекрестку");
				CrossRoad.getLockCardirE().lock();
				System.out.println("Зеленая машина (n) выезжает на перекресток");
				CrossRoad.getLockSectionWN().lock();
				System.out.println("Зеленая машина (n) занимает секцию WN");
				CrossRoad.getLockSectionWS().lock();
				System.out.println("Зеленая машина (n) занимает секцию WS");
				try {
					//РЅРµ Р·РЅР°СЋ Р·Р°С‡РµРј С‚СѓС‚ РІРѕРѕР±С‰Рµ Р±СѓР»РµРІСЃРєРёРµ РїРµСЂРµРјРµРЅРЅС‹Рµ,
					//РЅР° РЅРёС… РЅРёРєС‚Рѕ РЅРµ СЃРјРѕС‚СЂРёС‚, РЅРѕ СЂР°Р· СѓР¶ РїРѕРїСЂРѕСЃРёР»Рё..
					CrossRoad.setBusyCardirN(true);	//Р·Р°С…РІР°С‚С‹РІР°РµРј СЃРІРѕСЋ СЃС‚РѕСЂРѕРЅСѓ СЃРІРµС‚Р°
					CrossRoad.setBusyCardirE(true);	//Р·Р°С…РІР°С‚С‹РІР°РµРј СЃС‚РѕСЂРѕРЅСѓ СЃРІРµС‚Р°, РєРѕС‚РѕСЂР°СЏ СЃР»РµРІР°
					CrossRoad.setBusySectionWN(true);		
					CrossRoad.setBusySectionWS(true);
					
					//Р·Р°С…РІР°С‚РёР»Рё, СЂР°РґСѓРµРјСЃСЏ Рё Р¶РґРµРј РєР°РєРѕРµ-С‚Рѕ РІСЂРµРјСЏ
					Thread.sleep(500);
					
					//РѕС‚РїСѓСЃРєР°РµРј РІСЃРµС…, РєРѕРіРѕ Р·Р°С…РІР°С‚РёР»Рё
					CrossRoad.setBusyCardirN(false);	//Р·Р°С…РІР°С‚С‹РІР°РµРј СЃРІРѕСЋ СЃС‚РѕСЂРѕРЅСѓ СЃРІРµС‚Р°
					CrossRoad.setBusyCardirE(false);	//Р·Р°С…РІР°С‚С‹РІР°РµРј СЃС‚РѕСЂРѕРЅСѓ СЃРІРµС‚Р°, РєРѕС‚РѕСЂР°СЏ СЃР»РµРІР°
					CrossRoad.setBusySectionWN(false);		
					CrossRoad.setBusySectionWS(false);
					
				} finally {
					CrossRoad.getLockCardirN().unlock();
					CrossRoad.getLockCardirE().unlock();
					CrossRoad.getLockSectionWN().unlock();
					CrossRoad.getLockSectionWS().unlock();
				}
				
				System.out.println("Зеленая машина (n) покинула перекресток");
				
			} catch (InterruptedException e) {
				e.printStackTrace();
			}
		}
	}

}
